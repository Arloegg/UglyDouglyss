{% extends 'base.html' %}

{% block content %}
  <article class="post">
    <header>
      <div>
        <h1>{{ post['title'] }}</h1>
        <div class="about">by {{ post['username'] }} on {{ post['created'].strftime('%Y-%m-%d') }}</div>
      </div>
      {% if g.user['id'] == post['author_id'] %}
        <a class="action" href="{{ url_for('blog.update', id=post['id']) }}">Edit</a>
      {% endif %}
    </header>
    <p class="body">{{ post['body'] }}</p>
  </article>

  <h2>Comments for "{{ post['title'] }}"</h2>
  <a class="action" href="{{ url_for('blog.index') }}">Back to Posts</a>

  <form method="post">
    <label for="comment">Comment</label>
    <textarea name="comment" id="comment" rows="4" cols="20" required style="resize: none !important; width: 100%; max-width: 920px; height: 50px !important; min-height: 50px !important;"></textarea>
    <button type="submit" value="PostComment">Post Comment</button>
  </form>

  {% for comment in comments %}
    <article class="comment">
      <header>
        <h2 class="body">{{ comment['body'] }}</h2>
        <div>
          <div class="about">by {{ comment['username'] }} on {{ comment['created'].strftime('%Y-%m-%d') }}</div>
        </div>
        
        {# Only show Edit if the logged-in user is the author of the comment #}
        {% if g.user and g.user['id'] == comment['author_id'] %}
          <a class="action" href="{{ url_for('blog.update_comment', postid=post['id'], id=comment['id']) }}">Edit</a>
        {% endif %}
    </article>

    {% if not loop.last %}
        <hr>
    {% endif %}
  {% else %}
    <p>No comments yet.</p>
  {% endfor %}
{% endblock %}
